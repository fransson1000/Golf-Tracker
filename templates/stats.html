<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Club Stats – Golf Tracker</title>
        <!-- Shared stylesheet for all pages -->
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    </head>

    <body>
        <div class="container">
            <!-- Page title -->
            <h1>Club Stats</h1>

            <!-- Primary navigation used across the site -->
            <nav>
                <a href="/">Home</a>
                <a href="/clubs">My Clubs</a>
                <a href="/shots">Log &amp; View Shots</a>
                <a href="/stats">View Stats</a>
                <span class="nav-user">User: {{ session.username }}</span>
                <a href="/logout">Log out</a>
            </nav>

            <!-- Date filter for stats and spray chart -->
            <form action="/stats" method="get" class="filter-form">
                <p>
                    <label>
                        Date:
                        <input type="date" name="date" value="{{ selected_date or '' }}">
                    </label>
                    <button type="submit" class="btn">Show this date</button>
                    <a href="/stats" class="btn">Show all dates</a>
                </p>
            </form>

            {% if selected_date %}
                <p>Currently showing stats for <strong>{{ selected_date }}</strong> only.</p>
            {% else %}
                <p>Currently showing stats for all recorded shots.</p>
            {% endif %}

            <!-- Table: one row per club with averages and left/center/right percentages -->
            <table>
                <thead>
                    <tr>
                        <th>Club #</th>
                        <th>Avg Carry (yd / m)</th>
                        <th>Shots Logged</th>
                        <th>Left %</th>
                        <th>Left-Center %</th>
                        <th>Center %</th>
                        <th>Right-Center %</th>
                        <th>Right %</th>
                        <th>Other %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in stats %}
                        <tr>
                            <td>
                            <!-- Club name plus optional head/shaft details -->
                                {{ row.name }}
                                {% if row.notes %}
                                    <br><small>{{ row.notes }}</small>
                                {% endif %}
                            </td>
                            <td>
                            <!-- Distance stored in yards; meters are computed here for display -->
                                {{ row.avg_distance }} yd
                                ({{ (row.avg_distance * 0.9144) | round(1) }} m)
                            </td>
                            <td>{{ row.shot_count }}</td>
                        <!-- Percentages are computed in app.py from the result text for each shot -->
                            <td>{{ row.left_pct }}</td>
                            <td>{{ row.center_left_pct }}</td>
                            <td>{{ row.center_pct }}</td>
                            <td>{{ row.center_right_pct }}</td>
                            <td>{{ row.right_pct }}</td>
                            <td>{{ row.other_pct }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if spray_shots %}
            <!-- Visual “driving range” view of all shots, colored by club -->
                <h2>Shot Dispersion (Driving Range View)</h2>
                <div class="range-box">
                <!-- One dot for each shot: position (x,y) and color are computed in app.py -->
                    {% for shot in spray_shots %}
                        <span class="spray-dot" style="left: {{ shot.x }}%; bottom: {{ shot.y }}%; background-color: {{ shot.color }};" title="{{ shot.label }} – {{ shot.distance }} yd ({{ shot.result_raw }})">
                        </span>
                    {% endfor %}

                <!-- Horizontal distance grid lines every 50 yards, with labels -->
                    {% for tick in range_ticks %}
                        <div class="range-tick" style="bottom: {{ tick.y }}%;">
                            <span class="range-tick-label">{{ tick.value }} yd</span>
                        </div>
                    {% endfor %}

                <!-- Left/center/right labels at the bottom of the range -->
                    <div class="range-label range-label-left">Left</div>
                    <div class="range-label range-label-center">Center</div>
                    <div class="range-label range-label-right">Right</div>
                </div>

            <!-- Legend: shows which color corresponds to which club (name + notes) -->
                <ul class="spray-legend">
                    {% for item in spray_legend %}
                        <li>
                            <span class="legend-swatch" style="background-color: {{ item.color }};"></span>
                            {{ item.label }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                {% if selected_date %}
                    <p>No shots logged for {{ selected_date }} to plot on the spray chart.</p>
                {% else %}
            <!-- Fallback if there are no shots in the database yet -->
                    <p>No shots logged yet for the Dispersion chart.</p>
                {% endif %}
            {% endif %}
        </div>
    </body>

</html>
